# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

VibeGuard 是一个 VSCode 扩展，专门为非专业程序员但需要用 AI 辅助编程的人群设计（如设计师、运营、产品经理等）。这些用户可能完全不懂编程，容易被 AI 生成的危险代码误导，比如删库、泄露密钥、开启调试模式等。项目的核心特色是用通俗易懂的中文和生活化比喻来解释技术问题，让完全不懂代码的人也能理解风险。

## 常用开发命令

```bash
# 编译项目
npm run compile

# 开发时监听模式（自动重新编译）
npm run watch

# 运行测试
npm test

# 运行特定测试文件
npm test -- --grep "测试名称"

# 打包扩展
npm run package

# 发布到 VSCode Marketplace
npm run publish
```

## 核心架构

### 1. 扩展生命周期 (`src/extension.ts`)
- `activate()`: 扩展激活时初始化分析器、诊断管理器等核心组件
- `deactivate()`: 清理资源
- 使用 VSCode API 注册命令和事件监听器

### 2. 代码分析引擎 (`src/analyzer/CodeAnalyzer.ts`)
- 基于规则的分析系统，支持多种编程语言
- 实现了增量分析和性能优化（缓存、防抖）
- 分析流程：文件变更 → 语言检测 → 应用规则 → 生成诊断

### 3. 规则系统 (`src/rules/`)
- 每种语言都有独立的规则文件（如 `pythonRules.ts`、`javascriptRules.ts`）
- 规则包含：模式匹配、严重程度、错误消息、快速修复
- 支持正则表达式和自定义检测逻辑

### 4. 诊断集成 (`src/diagnostics/DiagnosticsManager.ts`)
- 将分析结果转换为 VSCode 诊断信息
- 管理诊断集合的更新和清理
- 提供快速修复功能

## 关键设计原则

1. **零编程基础友好**：目标用户是设计师、运营、产品经理等非技术人员，所有提示必须用生活化比喻解释
2. **聚焦高危操作**：重点检测删库、密钥泄露、数据丢失等可能造成严重后果的操作
3. **中文优先**：所有提示、错误信息都用地道的中文表达，避免任何技术术语
4. **性能优先**：使用缓存、防抖、增量分析等技术优化性能
5. **保守修复**：宁可不提供修复也不要引入新问题，因为用户可能无法判断修复是否正确

## 重要配置

- `.vscode/launch.json`: 调试配置，按 F5 启动扩展主机
- `package.json`: 扩展清单，定义命令、配置项、激活事件
- `tsconfig.json`: TypeScript 配置，目标 ES2022

## 测试策略

- 单元测试位于 `src/test/` 目录
- 使用 Mocha 测试框架
- 测试覆盖规则验证、分析器逻辑、快速修复功能

## 添加新功能指南

### 添加新的检测规则
1. 在对应语言的规则文件中添加新规则（如 `src/rules/pythonRules.ts`）
2. 遵循现有规则格式：模式、严重程度、消息、快速修复
3. 在测试文件中添加相应测试用例

### 支持新语言
1. 创建新的规则文件 `src/rules/[language]Rules.ts`
2. 在 `RuleRegistry` 中注册新语言
3. 更新 `package.json` 中的 `activationEvents`

## 注意事项

- **核心理念**：记住目标用户是完全不懂编程的人（设计师、运营、产品经理），他们用 AI 写代码但无法判断代码安全性
- **错误提示风格**：必须用生活化比喻，比如"SQL注入"要解释成"把钥匙放在门口让小偷随便进"
- **检测重点**：优先检测那些会造成不可挽回损失的操作（删库、泄露密钥、数据丢失、安全漏洞）
- **性能考虑**：避免在大文件上执行复杂的正则表达式
- **修复策略**：提供的修复方案必须是安全的，用户无法判断修复是否引入新问题
- **测试要求**：所有新功能都需要添加测试，特别是要测试各种 AI 可能生成的危险代码模式